Bootstrap: docker
From: rockylinux/rockylinux:8.4

%setup
    mkdir -p ${APPTAINER_ROOTFS}/usr/lib64/slurm
    mkdir -p ${APPTAINER_ROOTFS}/etc/slurm
    mkdir -p ${APPTAINER_ROOTFS}/etc/munge
    mkdir -p ${APPTAINER_ROOTFS}/var/log/munge
    mkdir -p ${APPTAINER_ROOTFS}/run/munge
    mkdir -p ${APPTAINER_ROOTFS}/temp_data
    mkdir -p ${APPTAINER_ROOTFS}/data
    touch ${APPTAINER_ROOTFS}/usr/bin/srun
    touch ${APPTAINER_ROOTFS}/usr/bin/sbatch

%files
    pyproject.toml /pyproject.toml
    uv.lock /uv.lock
    README.md /README.md

%environment
    export DEBIAN_FRONTEND=noninteractive
    export PYTHONPATH=./src:$PYTHONPATH
    export UV_LINK_MODE=copy

%post
    #groupadd -g 12067 slurm
    #useradd  -m -d /tmp -u 13504 -g slurm -s /bin/false slurm
    #groupadd -g 119 munge
    #useradd  -m -d /nonexistent -u 114 -g munge -s /usr/sbin/nologin munge
    yum install -y openssh-clients
    curl -LsSf https://astral.sh/uv/install.sh | env UV_INSTALL_DIR="/uv" sh
